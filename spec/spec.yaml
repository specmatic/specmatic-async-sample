---
asyncapi: "3.0.0"
info:
  title: "Order API"
  version: "1.0.0"
servers:
  sqsServer:
    host: "http://localhost:4566/000000000000"
    protocol: "sqs"
    description: "AWS SQS server"
  kafkaServer:
    host: "localhost:9092"
    protocol: "kafka"
    description: "Kafka broker"
  mqttServer:
    host: "tcp://localhost:1884"
    protocol: "mqtt"
    description: "MQTT server"
  jmsServer:
    host: "tcp://localhost:61616"
    protocol: "jms"
    description: "JMS server"
  ibmmqServer:
    host: "tcp://localhost:1415"
    protocol: "ibmmq"
    description: "IBM MQ server"
  amqpServer:
    host: "amqp://localhost:5673"
    protocol: "amqp"
    description: "RabbitMQ AMQP server"
channels:
  NewOrderPlaced:
    address: "new-orders"
    servers:
    - $ref: "#/servers/ibmmqServer"
    messages:
      placeOrder.message:
        $ref: "#/components/messages/OrderRequest"
  OrderInitiated:
    address: "wip-orders"
    servers:
    - $ref: "#/servers/ibmmqServer"
    messages:
      processOrder.message:
        $ref: "#/components/messages/Order"
  OrderCancellationRequested:
    address: "to-be-cancelled-orders"
    servers:
    - $ref: "#/servers/ibmmqServer"
    messages:
      cancelOrder.message:
        $ref: "#/components/messages/CancelOrderRequest"
  OrderCancelled:
    address: "cancelled-orders"
    servers:
    - $ref: "#/servers/ibmmqServer"
    messages:
      processCancellation.message:
        $ref: "#/components/messages/CancellationReference"
  OrderAccepted:
    address: "accepted-orders"
    servers:
    - $ref: "#/servers/ibmmqServer"
    messages:
      orderAccepted.message:
        $ref: "#/components/messages/OrderAccepted"
  OrderDeliveryInitiated:
    address: "out-for-delivery-orders"
    servers:
    - $ref: "#/servers/ibmmqServer"
    messages:
      orderDeliveryInitiation.message:
        $ref: "#/components/messages/OutForDelivery"
operations:
  placeOrder:
    action: "receive"
    channel:
      $ref: "#/channels/NewOrderPlaced"
    messages:
    - $ref: "#/channels/NewOrderPlaced/messages/placeOrder.message"
    reply:
      channel:
        $ref: "#/channels/OrderInitiated"
      messages:
      - $ref: "#/channels/OrderInitiated/messages/processOrder.message"
  cancelOrder:
    action: "receive"
    channel:
      $ref: "#/channels/OrderCancellationRequested"
    messages:
    - $ref: "#/channels/OrderCancellationRequested/messages/cancelOrder.message"
    reply:
      channel:
        $ref: "#/channels/OrderCancelled"
      messages:
      - $ref: "#/channels/OrderCancelled/messages/processCancellation.message"
  orderAccepted:
    action: "send"
    channel:
      $ref: "#/channels/OrderAccepted"
    messages:
    - $ref: "#/channels/OrderAccepted/messages/orderAccepted.message"
  initiateOrderDelivery:
    action: "receive"
    channel:
      $ref: "#/channels/OrderDeliveryInitiated"
    messages:
    - $ref: "#/channels/OrderDeliveryInitiated/messages/orderDeliveryInitiation.message"
components:
  messages:
    OrderRequest:
      name: "OrderRequest"
      title: "An order request"
      contentType: "application/json"
      headers:
        type: "object"
        properties:
          orderCorrelationId:
            type: "string"
            description: "Unique identifier for the request"
        additionalProperties: true
      payload:
        type: "object"
        required:
        - "id"
        - "orderItems"
        properties:
          id:
            type: "integer"
          orderItems:
            type: "array"
            items:
              type: "object"
              properties:
                id:
                  type: "integer"
                name:
                  type: "string"
                quantity:
                  type: "integer"
                price:
                  type: "number"
              required:
              - "id"
              - "name"
              - "quantity"
              - "price"
    Order:
      name: "OrderToProcess"
      title: "An order that needs to be processed"
      contentType: "application/json"
      headers:
        type: "object"
        properties:
          orderCorrelationId:
            type: "string"
            description: "Unique identifier for the request"
        additionalProperties: true
      payload:
        type: "object"
        required:
        - "id"
        - "totalAmount"
        - "status"
        properties:
          id:
            type: "integer"
          totalAmount:
            type: "number"
          status:
            $ref: "#/components/messages/OrderStatus"
    CancelOrderRequest:
      name: "CancelOrderRequest"
      title: "A cancel order request"
      contentType: "application/json"
      headers:
        type: "object"
        properties:
          orderCorrelationId:
            type: "string"
            description: "Unique identifier for the request"
        additionalProperties: true
      payload:
        type: "object"
        required:
        - "id"
        properties:
          id:
            type: "integer"
    CancellationReference:
      name: "CancellationReference"
      title: "A cancellation reference in response to a cancel order request"
      contentType: "application/json"
      headers:
        type: "object"
        properties:
          orderCorrelationId:
            type: "string"
            description: "Unique identifier for the request"
        additionalProperties: true
      payload:
        type: "object"
        required:
        - "reference"
        - "status"
        properties:
          reference:
            type: "integer"
          status:
            $ref: "#/components/messages/OrderStatus"
    OrderAccepted:
      name: "OrderAccepted"
      title: "Order accepted by Warehouse"
      contentType: "application/json"
      headers:
        type: "object"
        additionalProperties: true
      payload:
        type: "object"
        properties:
          id:
            type: "integer"
          status:
            $ref: "#/components/messages/OrderStatus"
          timestamp:
            type: "string"
        required:
        - "id"
        - "status"
        - "timestamp"
    OutForDelivery:
      name: "OutForDelivery"
      title: "Order is out for delivery"
      contentType: "application/json"
      payload:
        type: "object"
        required:
        - "orderId"
        - "deliveryAddress"
        - "deliveryDate"
        properties:
          orderId:
            type: "integer"
          deliveryAddress:
            type: "string"
          deliveryDate:
            type: "string"
            format: "date"
    OrderStatus:
      name: "OrderStatus"
      title: "Order status"
      payload:
        type: "string"
        enum:
        - "PENDING"
        - "INITIATED"
        - "ACCEPTED"
        - "SHIPPED"
        - "DELIVERED"
        - "CANCELLED"
